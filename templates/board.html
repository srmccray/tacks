{% extends "base.html" %}

{% block title %}Board â€” Tacks{% endblock %}

{% block content %}
<div id="content-area">

<form method="get" action="/board"
      hx-get="/board"
      hx-trigger="change from:select"
      hx-target="#content-area"
      hx-select="#content-area"
      hx-swap="outerHTML"
      hx-push-url="true">
  <div class="grid">
    <select name="epic">
      <option value="">All tasks</option>
      {% for epic in epics %}
      <option value="{{ epic.id }}" {% if selected_epic == epic.id %}selected{% endif %}>{{ epic.title }}</option>
      {% endfor %}
    </select>
    <select name="priority">
      <option value="">All priorities</option>
      <option value="1" {% if selected_priority == "1" %}selected{% endif %}>P1</option>
      <option value="2" {% if selected_priority == "2" %}selected{% endif %}>P2</option>
      <option value="3" {% if selected_priority == "3" %}selected{% endif %}>P3</option>
    </select>
    <noscript><button type="submit">Filter</button></noscript>
  </div>
</form>

<div class="grid" id="board-columns"
     hx-get="/board{{ poll_query }}"
     hx-trigger="every 2s [document.visibilityState === 'visible']"
     hx-target="#board-columns"
     hx-select="#board-columns">
  <div class="board-column" data-status="open">
    <h2>Open</h2>
    {% for row in open_tasks %}
    <article class="board-card" draggable="true" data-task-id="{{ row.task.id }}">
      <div class="board-card-header">
        <a href="/tasks/{{ row.task.id }}"
           hx-get="/tasks/{{ row.task.id }}"
           hx-target="#task-modal"
           hx-select="unset"
           hx-swap="innerHTML">{{ row.task.title }}</a>
        <span class="badge priority-{{ row.task.priority }}">P{{ row.task.priority }}</span>
      </div>
    </article>
    {% endfor %}
  </div>
  <div class="board-column" data-status="in_progress">
    <h2>In Progress</h2>
    {% for row in in_progress_tasks %}
    <article class="board-card" draggable="true" data-task-id="{{ row.task.id }}">
      <div class="board-card-header">
        <a href="/tasks/{{ row.task.id }}"
           hx-get="/tasks/{{ row.task.id }}"
           hx-target="#task-modal"
           hx-select="unset"
           hx-swap="innerHTML">{{ row.task.title }}</a>
        <span class="badge priority-{{ row.task.priority }}">P{{ row.task.priority }}</span>
      </div>
    </article>
    {% endfor %}
  </div>
  <div class="board-column" data-status="blocked">
    <h2>Blocked</h2>
    {% for row in blocked_tasks %}
    <article class="board-card" draggable="true" data-task-id="{{ row.task.id }}">
      <div class="board-card-header">
        <a href="/tasks/{{ row.task.id }}"
           hx-get="/tasks/{{ row.task.id }}"
           hx-target="#task-modal"
           hx-select="unset"
           hx-swap="innerHTML">{{ row.task.title }}</a>
        <span class="badge priority-{{ row.task.priority }}">P{{ row.task.priority }}</span>
      </div>
    </article>
    {% endfor %}
  </div>
  <div class="board-column" data-status="done">
    <h2>Done</h2>
    {% for row in done_tasks %}
    <article class="board-card" draggable="true" data-task-id="{{ row.task.id }}">
      <div class="board-card-header">
        <a href="/tasks/{{ row.task.id }}"
           hx-get="/tasks/{{ row.task.id }}"
           hx-target="#task-modal"
           hx-select="unset"
           hx-swap="innerHTML">{{ row.task.title }}</a>
        <span class="badge priority-{{ row.task.priority }}">P{{ row.task.priority }}</span>
      </div>
    </article>
    {% endfor %}
  </div>
</div>
</div>
{% endblock %}
