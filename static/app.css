/* Tacks custom component styles */

/* Override Pico CSS primary/accent color: blue → purple */
/* Must match Pico's specificity: :root:not([data-theme="dark"]) > :root */
:root:not([data-theme="dark"]) {
  --pico-primary: #7c3aed;
  --pico-primary-background: #7c3aed;
  --pico-primary-border: var(--pico-primary-background);
  --pico-primary-underline: rgba(124, 58, 237, 0.5);
  --pico-primary-hover: #5b21b6;
  --pico-primary-hover-background: #6d28d9;
  --pico-primary-hover-border: var(--pico-primary-hover-background);
  --pico-primary-hover-underline: var(--pico-primary-hover);
  --pico-primary-focus: rgba(124, 58, 237, 0.375);
  --pico-primary-inverse: #fff;
}

[data-theme="dark"] {
  --pico-primary: #a78bfa;
  --pico-primary-background: #7c3aed;
  --pico-primary-border: var(--pico-primary-background);
  --pico-primary-underline: rgba(167, 139, 250, 0.5);
  --pico-primary-hover: #c4b5fd;
  --pico-primary-hover-background: #8b5cf6;
  --pico-primary-hover-border: var(--pico-primary-hover-background);
  --pico-primary-hover-underline: var(--pico-primary-hover);
  --pico-primary-focus: rgba(167, 139, 250, 0.375);
  --pico-primary-inverse: #fff;
}

/* Base pill/badge */
.badge {
  display: inline-block;
  border-radius: 1em;
  padding: 0.1em 0.6em;
  font-size: 0.75em;
  font-weight: 600;
  line-height: 1.5;
  white-space: nowrap;
}

/* Status badges — light theme */
/* Backgrounds raised to 20% for better visible contrast against page bg */
.badge.status-open {
  background-color: color-mix(in srgb, #3b82f6 20%, transparent);
  color: #1d4ed8;
}

.badge.status-in_progress {
  background-color: color-mix(in srgb, #f59e0b 20%, transparent);
  color: #92400e;
}

.badge.status-done {
  background-color: color-mix(in srgb, #22c55e 20%, transparent);
  color: #166534;
}

.badge.status-blocked {
  background-color: color-mix(in srgb, #ef4444 20%, transparent);
  color: #991b1b;
}

/* Status badges — dark theme overrides */
/* 30% backgrounds, lighter text for ≥4.5:1 on dark page backgrounds */
[data-theme="dark"] .badge.status-open {
  background-color: color-mix(in srgb, #3b82f6 30%, transparent);
  color: #93c5fd;
}

[data-theme="dark"] .badge.status-in_progress {
  background-color: color-mix(in srgb, #f59e0b 30%, transparent);
  color: #fde68a;
}

[data-theme="dark"] .badge.status-done {
  background-color: color-mix(in srgb, #22c55e 30%, transparent);
  color: #86efac;
}

[data-theme="dark"] .badge.status-blocked {
  background-color: color-mix(in srgb, #ef4444 30%, transparent);
  color: #fca5a5;
}

/* Tag pills */
/* Explicit fallback colors chosen for ≥4.5:1 contrast on white/dark backgrounds */
.tag-pill {
  display: inline-block;
  border-radius: 1em;
  padding: 0.1em 0.6em;
  font-size: 0.75em;
  font-weight: 500;
  line-height: 1.5;
  white-space: nowrap;
  border: 1px solid var(--pico-muted-border-color, #c4c9d4);
  color: var(--pico-muted-color, #4b5563);
  margin-right: 0.25em;
}

[data-theme="dark"] .tag-pill {
  border-color: var(--pico-muted-border-color, #4b5563);
  color: var(--pico-muted-color, #d1d5db);
}

/* Tag multi-select dropdown widget */
.tag-multiselect {
  position: relative;
}

/* Trigger — looks like a form control, shows selected pills */
.tag-multiselect-trigger {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.3em;
  min-height: calc(var(--pico-form-element-spacing-vertical, 0.75rem) * 2 + var(--pico-line-height, 1.5) * 1rem + 2px);
  box-sizing: border-box;
  border: 1px solid var(--pico-form-element-border-color, #767676);
  border-radius: var(--pico-border-radius, 0.25rem);
  padding: var(--pico-form-element-spacing-vertical, 0.75rem) 0.6em;
  background-color: var(--pico-form-element-background-color, #fff);
  cursor: pointer;
  user-select: none;
}

.tag-multiselect-trigger:focus {
  border-color: var(--pico-primary, #7c3aed);
  box-shadow: 0 0 0 2px var(--pico-primary-focus, rgba(124,58,237,0.375));
  outline: none;
}

.tag-multiselect-pills {
  display: contents;
}

.tag-multiselect-placeholder {
  color: var(--pico-form-element-placeholder-color, #9ca3af);
  font-size: inherit;
  flex: 1;
}

.tag-multiselect-caret {
  font-size: 0.7em;
  color: var(--pico-muted-color, #6b7280);
  margin-left: auto;
  padding-left: 0.4em;
  flex-shrink: 0;
}

/* Filter tag pill (inside the multi-select trigger) */
.filter-tag-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.25em;
  border-radius: 1em;
  padding: 0.1em 0.5em;
  font-size: 0.8em;
  font-weight: 600;
  white-space: nowrap;
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 15%, transparent);
  color: var(--pico-primary, #7c3aed);
  border: 1px solid color-mix(in srgb, var(--pico-primary, #7c3aed) 40%, transparent);
}

.filter-tag-pill-remove {
  all: unset;
  cursor: pointer;
  line-height: 1;
  font-size: 1.1em;
  color: var(--pico-primary, #7c3aed);
  opacity: 0.7;
}

.filter-tag-pill-remove:hover {
  opacity: 1;
}

/* Dropdown list */
.tag-multiselect-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  list-style: none;
  margin: 0;
  padding: 0.25em 0;
  background-color: var(--pico-card-background-color, #fff);
  border: 1px solid var(--pico-muted-border-color, #d1d5db);
  border-radius: var(--pico-border-radius, 0.25rem);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  z-index: 100;
  max-height: 16em;
  overflow-y: auto;
}

.tag-multiselect-dropdown[hidden] {
  display: none;
}

.tag-dropdown-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.35em 0.75em;
  cursor: pointer;
  font-size: 0.9em;
  color: var(--pico-color, inherit);
}

.tag-dropdown-option:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 8%, transparent);
}

.tag-dropdown-option.selected {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 10%, transparent);
}

.tag-dropdown-empty {
  padding: 0.5em 0.75em;
  font-size: 0.9em;
  color: var(--pico-muted-color, #6b7280);
  font-style: italic;
}

.tag-check {
  font-size: 0.85em;
  color: var(--pico-primary, #7c3aed);
  font-weight: 700;
  flex-shrink: 0;
}

/* Dark theme overrides */
[data-theme="dark"] .tag-multiselect-trigger {
  background-color: var(--pico-form-element-background-color, #1e1e2e);
  border-color: var(--pico-form-element-border-color, #4a4a6a);
}

[data-theme="dark"] .tag-multiselect-dropdown {
  background-color: var(--pico-card-background-color, #1e1e2e);
  border-color: var(--pico-muted-border-color, #374151);
}

[data-theme="dark"] .filter-tag-pill {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 25%, transparent);
  color: var(--pico-primary, #a78bfa);
  border-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 50%, transparent);
}

[data-theme="dark"] .filter-tag-pill-remove {
  color: var(--pico-primary, #a78bfa);
}

[data-theme="dark"] .tag-check {
  color: var(--pico-primary, #a78bfa);
}

[data-theme="dark"] .tag-dropdown-option:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 12%, transparent);
}

[data-theme="dark"] .tag-dropdown-option.selected {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 15%, transparent);
}

/* Priority badges — light theme */
/* 20% backgrounds and darkened text ensure ≥4.5:1 contrast for WCAG AA */
.badge.priority-1 {
  background-color: color-mix(in srgb, #ef4444 20%, transparent);
  color: #991b1b;
}
.badge.priority-2 {
  background-color: color-mix(in srgb, #3b82f6 20%, transparent);
  color: #1d4ed8;
}
.badge.priority-3 {
  background-color: color-mix(in srgb, #6b7280 20%, transparent);
  color: #374151;
}

/* Timestamp column: never wrap */
.col-updated {
  white-space: nowrap;
}

/* Board card: clean compact layout */
.board-card {
  padding-bottom: 0.5rem;
}

/* Board card header: title link + priority pill on one line */
.board-card-header {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.board-card-header a {
  flex: 1;
  min-width: 0;
  overflow-wrap: break-word;
  word-break: break-word;
}

/* Nav tab bar */
nav.nav-tabs {
  border-bottom: 1px solid var(--pico-muted-border-color, #d1d5db);
  margin-bottom: 0;
}

/* Increase spacing between nav items */
nav.nav-tabs ul:last-child {
  gap: 0.5rem;
}

nav.nav-tabs ul:last-child li a {
  /* Remove Pico's default link decoration from nav items */
  text-decoration: none;
  color: var(--pico-muted-color, #6b7280);
  padding: 0.5rem 0.1rem;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px; /* overlap the nav border-bottom */
  display: inline-block;
  font-weight: 400;
  transition: color 0.15s, border-color 0.15s;
}

nav.nav-tabs ul:last-child li a:hover {
  color: var(--pico-color, inherit);
  border-bottom-color: var(--pico-muted-border-color, #d1d5db);
}

nav.nav-tabs ul:last-child li a.nav-active {
  color: var(--pico-primary, #7c3aed);
  border-bottom-color: var(--pico-primary, #7c3aed);
  font-weight: 600;
}

[data-theme="dark"] nav.nav-tabs {
  border-bottom-color: var(--pico-muted-border-color, #374151);
}

[data-theme="dark"] nav.nav-tabs ul:last-child li a {
  color: var(--pico-muted-color, #9ca3af);
}

[data-theme="dark"] nav.nav-tabs ul:last-child li a:hover {
  color: var(--pico-color, #e5e7eb);
  border-bottom-color: var(--pico-muted-border-color, #374151);
}

[data-theme="dark"] nav.nav-tabs ul:last-child li a.nav-active {
  color: var(--pico-primary, #a78bfa);
  border-bottom-color: var(--pico-primary, #a78bfa);
}

/* Settings gear dropdown */
.settings-dropdown {
  position: relative;
  display: inline-block;
}

.settings-gear-btn {
  padding: 0.25rem 0.5rem !important;
  font-size: 1rem !important;
  line-height: 1 !important;
  border: none !important;
  background: none !important;
  color: var(--pico-muted-color, #6b7280) !important;
  box-shadow: none !important;
  cursor: pointer;
}

.settings-gear-btn:hover {
  color: var(--pico-color, inherit) !important;
}

.settings-menu {
  position: absolute;
  top: calc(100% + 4px);
  right: 0;
  min-width: 10rem;
  list-style: none;
  margin: 0;
  padding: 0.25rem 0;
  /* Explicit colors — do not rely on Pico defaults which may not cascade here */
  background-color: #ffffff;
  color: #1a1a2e;
  border: 1px solid #d1d5db;
  border-radius: var(--pico-border-radius, 0.25rem);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  z-index: 200;
}

.settings-menu li {
  padding: 0;
  margin: 0;
}

.settings-menu-btn {
  all: unset;
  display: block;
  width: 100%;
  padding: 0.45rem 0.85rem;
  font-size: 0.9rem;
  /* Explicit color: all:unset resets color; set it explicitly for both themes */
  color: #1a1a2e;
  cursor: pointer;
  white-space: nowrap;
  box-sizing: border-box;
}

.settings-menu-btn:hover {
  background-color: color-mix(in srgb, #7c3aed 10%, transparent);
  color: #7c3aed;
}

[data-theme="dark"] .settings-menu {
  background-color: #1e1e2e;
  color: #e5e7eb;
  border-color: #374151;
}

[data-theme="dark"] .settings-menu-btn {
  color: #e5e7eb;
}

[data-theme="dark"] .settings-gear-btn {
  color: var(--pico-muted-color, #9ca3af) !important;
}

[data-theme="dark"] .settings-gear-btn:hover {
  color: var(--pico-color, #e5e7eb) !important;
}

[data-theme="dark"] .settings-menu-btn:hover {
  background-color: color-mix(in srgb, #a78bfa 15%, transparent);
  color: #a78bfa;
}

/* Compact task/epic metadata row */
.task-meta-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.3em;
  font-size: 0.875rem;
  color: var(--pico-muted-color, #6b7280);
  margin-bottom: 1rem;
}

.meta-item {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  white-space: nowrap;
}

.meta-label {
  font-weight: 500;
  color: var(--pico-muted-color, #6b7280);
}

.meta-sep {
  color: var(--pico-muted-border-color, #d1d5db);
  user-select: none;
}

.task-description {
  margin-bottom: 1.25rem;
  color: var(--pico-color, inherit);
}

/* Epic badge — small linked pill used in list/board/detail views */
.epic-badge {
  display: inline-block;
  border-radius: 1em;
  padding: 0.1em 0.55em;
  font-size: 0.72em;
  font-weight: 500;
  line-height: 1.5;
  white-space: nowrap;
  text-decoration: none;
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 10%, transparent);
  color: var(--pico-primary, #7c3aed);
  border: 1px solid color-mix(in srgb, var(--pico-primary, #7c3aed) 30%, transparent);
  vertical-align: middle;
  transition: background-color 0.15s;
}

.epic-badge:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 18%, transparent);
  text-decoration: none;
}

[data-theme="dark"] .epic-badge {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 15%, transparent);
  color: var(--pico-primary, #a78bfa);
  border-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 35%, transparent);
}

[data-theme="dark"] .epic-badge:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 25%, transparent);
}

[data-theme="dark"] .meta-sep {
  color: var(--pico-muted-border-color, #374151);
}

/* Epic detail: divider between description and view toggle */
.view-toggle-divider {
  margin: 0.75rem 0;
  border: none;
  border-top: 1px solid var(--pico-muted-border-color, #d1d5db);
}

[data-theme="dark"] .view-toggle-divider {
  border-top-color: var(--pico-muted-border-color, #374151);
}

/* Epic detail: right-aligned pill toggle button group */
.view-toggle-row {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 1rem;
}

.view-toggle-group {
  display: inline-flex;
  border: 1px solid var(--pico-primary, #7c3aed);
  border-radius: 2em;
  overflow: hidden;
}

.view-toggle-btn {
  display: inline-block;
  padding: 0.25em 0.9em;
  font-size: 0.8rem;
  font-weight: 500;
  text-decoration: none;
  white-space: nowrap;
  cursor: default;
  background: transparent;
  color: var(--pico-primary, #7c3aed);
  border: none;
  transition: background-color 0.15s, color 0.15s;
}

a.view-toggle-btn {
  cursor: pointer;
}

a.view-toggle-btn:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 10%, transparent);
  text-decoration: none;
}

.view-toggle-active {
  background-color: var(--pico-primary, #7c3aed);
  color: #fff;
}

[data-theme="dark"] .view-toggle-group {
  border-color: var(--pico-primary, #a78bfa);
}

[data-theme="dark"] .view-toggle-btn {
  color: var(--pico-primary, #a78bfa);
}

[data-theme="dark"] a.view-toggle-btn:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 15%, transparent);
}

[data-theme="dark"] .view-toggle-active {
  background-color: var(--pico-primary-background, #7c3aed);
  color: #fff;
}

/* Priority-4 badge (light theme) */
/* Raised background to 18%, darkened text to #4b5563 for ≥4.5:1 contrast */
.badge.priority-4 {
  background-color: color-mix(in srgb, #6b7280 18%, transparent);
  color: #4b5563;
}

/* Priority-4 badge (dark theme) */
[data-theme="dark"] .badge.priority-4 {
  background-color: color-mix(in srgb, #6b7280 28%, transparent);
  color: #d1d5db;
}

/* --- Filter multi-select widget --- */

/* Container: same look as .tag-autocomplete */
.filter-multiselect {
  position: relative;
  box-sizing: border-box;
}

/* Trigger: the clickable "button" that shows selected pills */
.filter-multiselect-trigger {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.3em;
  min-height: calc(var(--pico-form-element-spacing-vertical, 0.75rem) * 2 + var(--pico-line-height, 1.5) * 1rem + 2px);
  box-sizing: border-box;
  border: 1px solid var(--pico-form-element-border-color, #767676);
  border-radius: var(--pico-border-radius, 0.25rem);
  padding: var(--pico-form-element-spacing-vertical, 0.75rem) 0.6em;
  background-color: var(--pico-form-element-background-color, #fff);
  cursor: pointer;
  user-select: none;
}

.filter-multiselect-trigger:focus {
  border-color: var(--pico-primary);
  box-shadow: 0 0 0 2px var(--pico-primary-focus, rgba(124,58,237,0.375));
  outline: none;
}

[data-theme="dark"] .filter-multiselect-trigger {
  background-color: var(--pico-form-element-background-color, #1e1e2e);
  border-color: var(--pico-form-element-border-color, #4a4a6a);
}

/* Placeholder text when nothing is selected */
.filter-multiselect-placeholder {
  color: var(--pico-muted-color, #6b7280);
  font-size: 0.95em;
}

/* Pill wrapper inside the trigger */
.filter-multiselect-pills {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 0.25em;
}

/* Individual selected-value pill inside the trigger */
.filter-multiselect-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.2em;
  border-radius: 1em;
  padding: 0.05em 0.45em;
  font-size: 0.78em;
  font-weight: 600;
  white-space: nowrap;
  line-height: 1.5;
}

.filter-multiselect-pill-remove {
  all: unset;
  cursor: pointer;
  line-height: 1;
  font-size: 1.05em;
  opacity: 0.7;
}

.filter-multiselect-pill-remove:hover {
  opacity: 1;
}

/* Dropdown list */
.filter-multiselect-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  list-style: none;
  margin: 0;
  padding: 0.25em 0;
  background-color: var(--pico-card-background-color, #fff);
  border: 1px solid var(--pico-muted-border-color, #d1d5db);
  border-radius: var(--pico-border-radius, 0.25rem);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  z-index: 100;
  min-width: 100%;
}

.filter-multiselect-dropdown[hidden] {
  display: none;
}

.filter-multiselect-dropdown li {
  display: flex;
  align-items: center;
  gap: 0.5em;
  padding: 0.35em 0.75em;
  cursor: pointer;
  font-size: 0.9em;
  color: var(--pico-color, inherit);
}

.filter-multiselect-dropdown li:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 8%, transparent);
}

/* Checkmark indicator for selected items */
.filter-multiselect-dropdown li::before {
  content: '';
  display: inline-block;
  width: 1em;
  height: 1em;
  flex-shrink: 0;
}

.filter-multiselect-dropdown li[aria-selected="true"]::before {
  content: '✓';
  color: var(--pico-primary, #7c3aed);
  font-weight: 700;
}

[data-theme="dark"] .filter-multiselect-dropdown {
  background-color: var(--pico-card-background-color, #1e1e2e);
  border-color: var(--pico-muted-border-color, #374151);
}

[data-theme="dark"] .filter-multiselect-dropdown li:hover {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 12%, transparent);
}

[data-theme="dark"] .filter-multiselect-dropdown li[aria-selected="true"]::before {
  color: var(--pico-primary, #a78bfa);
}

/* Priority badges — dark theme */
/* Backgrounds at 28-30%, lighter text for ≥4.5:1 on dark backgrounds */
[data-theme="dark"] .badge.priority-1 {
  background-color: color-mix(in srgb, #ef4444 30%, transparent);
  color: #fca5a5;
}
[data-theme="dark"] .badge.priority-2 {
  background-color: color-mix(in srgb, #3b82f6 30%, transparent);
  color: #93c5fd;
}
[data-theme="dark"] .badge.priority-3 {
  background-color: color-mix(in srgb, #6b7280 28%, transparent);
  color: #d1d5db;
}

/* --- Inline editing --- */

/* Element in edit mode */
[data-editable].editing {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: var(--pico-border-radius, 0.25rem);
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 5%, transparent);
  padding: 0.1em 0.25em;
  margin: -0.1em -0.25em;
  transition: outline 0.1s, background-color 0.1s;
}

/* Hint cursor on editable elements */
[data-editable]:not(.editing) {
  cursor: pointer;
}

[data-editable]:not(.editing):hover {
  text-decoration: underline dotted var(--pico-muted-color, #6b7280);
}

/* Pencil icon affordance — appears on hover to indicate the field is editable */
[data-editable]:not(.editing)::after {
  content: '';
  display: none;
}

[data-editable]:not(.editing):hover::after {
  content: ' \270E'; /* ✎ pencil */
  display: inline;
  font-size: 0.75em;
  opacity: 0.45;
  margin-left: 0.2em;
  vertical-align: middle;
  font-style: normal;
  text-decoration: none;
}

/* Editable cell wrapper: flex row so input + buttons stay on one line */
.inline-edit-wrapper {
  display: flex;
  align-items: center;
  gap: 0.25em;
  width: 100%;
  min-width: 0;
}

/* Inputs created by inline edit inherit surrounding typography */
.inline-edit-input {
  font-size: inherit;
  font-family: inherit;
  font-weight: inherit;
  line-height: inherit;
  color: inherit;
  border: none;
  border-bottom: 2px solid var(--pico-primary, #7c3aed);
  background: transparent;
  outline: none;
  padding: 0;
  margin: 0;
  /* Shrink to fit remaining space beside the action buttons */
  flex: 1;
  min-width: 0;
  box-sizing: border-box;
}

.inline-edit-input:focus {
  outline: none;
}

/* Save/cancel action buttons shown during inline edit */
.inline-edit-actions {
  display: inline-flex;
  align-items: center;
  gap: 0.15em;
  flex-shrink: 0;
}

.inline-edit-btn {
  all: unset;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.4em;
  height: 1.4em;
  border-radius: 50%;
  font-size: 0.75em;
  line-height: 1;
  cursor: pointer;
  transition: background-color 0.1s, color 0.1s;
}

.inline-edit-btn-save {
  color: #15803d;
  background-color: color-mix(in srgb, #22c55e 15%, transparent);
}

.inline-edit-btn-save:hover {
  background-color: color-mix(in srgb, #22c55e 30%, transparent);
}

.inline-edit-btn-cancel {
  color: #b91c1c;
  background-color: color-mix(in srgb, #ef4444 10%, transparent);
}

.inline-edit-btn-cancel:hover {
  background-color: color-mix(in srgb, #ef4444 25%, transparent);
}

[data-theme="dark"] .inline-edit-btn-save {
  color: #4ade80;
  background-color: color-mix(in srgb, #22c55e 20%, transparent);
}

[data-theme="dark"] .inline-edit-btn-save:hover {
  background-color: color-mix(in srgb, #22c55e 35%, transparent);
}

[data-theme="dark"] .inline-edit-btn-cancel {
  color: #f87171;
  background-color: color-mix(in srgb, #ef4444 15%, transparent);
}

[data-theme="dark"] .inline-edit-btn-cancel:hover {
  background-color: color-mix(in srgb, #ef4444 30%, transparent);
}

/* Select inputs in edit mode */
.inline-edit-select {
  font-size: inherit;
  font-family: inherit;
  font-weight: inherit;
  line-height: inherit;
  border: none;
  border-bottom: 2px solid var(--pico-primary, #7c3aed);
  background: var(--pico-form-element-background-color, #fff);
  color: inherit;
  outline: none;
  padding: 0.1em 0.25em;
  margin: 0;
  box-sizing: border-box;
  cursor: pointer;
}

[data-theme="dark"] .inline-edit-select {
  background: var(--pico-form-element-background-color, #1e1e2e);
}

/* Textarea for description editing */
.inline-edit-textarea {
  font-size: inherit;
  font-family: inherit;
  font-weight: inherit;
  line-height: inherit;
  color: inherit;
  border: 1px solid var(--pico-primary, #7c3aed);
  border-radius: var(--pico-border-radius, 0.25rem);
  background: var(--pico-form-element-background-color, #fff);
  outline: none;
  padding: 0.4em 0.5em;
  margin: 0;
  width: 100%;
  min-height: 5em;
  resize: vertical;
  box-sizing: border-box;
}

[data-theme="dark"] .inline-edit-textarea {
  background: var(--pico-form-element-background-color, #1e1e2e);
}

/* Error flash — briefly shown on save failure */
[data-editable].edit-error {
  outline-color: #ef4444;
  background-color: color-mix(in srgb, #ef4444 8%, transparent);
  animation: edit-error-shake 0.3s ease;
}

@keyframes edit-error-shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

/* Validation error indicator on the input/select/textarea itself */
.edit-input-error {
  outline: 2px solid #ef4444 !important;
  background-color: color-mix(in srgb, #ef4444 6%, transparent) !important;
}

[data-theme="dark"] .edit-input-error {
  outline-color: #f87171 !important;
  background-color: color-mix(in srgb, #ef4444 12%, transparent) !important;
}

/* Modal title: leave room for the Pico CSS close button (rel=prev, abs-positioned top-right) */
#task-modal article header h3 {
  padding-right: 2.5rem;
  margin-bottom: 0;
}
/* --- Board drag-and-drop --- */

/* Card being dragged: reduce opacity so origin is visible */
.board-card.dragging {
  opacity: 0.4;
  cursor: grabbing;
}

/* Board column heading: space below so drag-over highlight starts clear of the title */
.board-column h2,
.board-column h3 {
  margin-bottom: 0.75rem;
}
/* Column receiving a drag: highlight as valid drop target */
.board-column.drag-over {
  background-color: color-mix(in srgb, var(--pico-primary, #7c3aed) 8%, transparent);
  border-radius: var(--pico-border-radius, 0.25rem);
  outline: 2px dashed color-mix(in srgb, var(--pico-primary, #7c3aed) 50%, transparent);
  outline-offset: -2px;
}

[data-theme="dark"] .board-column.drag-over {
  background-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 12%, transparent);
  outline-color: color-mix(in srgb, var(--pico-primary, #a78bfa) 60%, transparent);
}

/* Brief red flash when a drop fails */
.board-card.drag-error {
  animation: drag-error-flash 0.6s ease;
}

@keyframes drag-error-flash {
  0%, 100% { background-color: transparent; }
  30% { background-color: color-mix(in srgb, #ef4444 20%, transparent); }
}

/* --- Toast notification system --- */

#toast-container {
  position: fixed;
  bottom: 1.25rem;
  right: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  z-index: 1000;
  pointer-events: none;
}

.toast {
  display: flex;
  align-items: center;
  gap: 0.5em;
  padding: 0.6em 1em;
  border-radius: var(--pico-border-radius, 0.25rem);
  font-size: 0.875rem;
  font-weight: 500;
  line-height: 1.4;
  max-width: 22rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.18);
  pointer-events: auto;
  /* Slide in from the right */
  animation: toast-in 0.25s ease forwards;
  transition: opacity 0.4s ease, transform 0.4s ease;
}

.toast.toast-hiding {
  opacity: 0;
  transform: translateX(110%);
}

@keyframes toast-in {
  from {
    opacity: 0;
    transform: translateX(110%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Error toast — red */
.toast.toast-error {
  background-color: #fee2e2;
  color: #991b1b;
  border: 1px solid #fca5a5;
}

/* Success toast — green */
.toast.toast-success {
  background-color: #dcfce7;
  color: #166534;
  border: 1px solid #86efac;
}

/* Info toast — blue */
.toast.toast-info {
  background-color: #dbeafe;
  color: #1d4ed8;
  border: 1px solid #93c5fd;
}

/* Dark theme overrides */
[data-theme="dark"] .toast.toast-error {
  background-color: #450a0a;
  color: #fca5a5;
  border-color: #7f1d1d;
}

[data-theme="dark"] .toast.toast-success {
  background-color: #052e16;
  color: #86efac;
  border-color: #14532d;
}

[data-theme="dark"] .toast.toast-info {
  background-color: #082f49;
  color: #93c5fd;
  border-color: #1e3a5f;
}

/* --- Screen reader only utility --- */
/* Visually hidden but accessible to screen readers (WCAG technique G1) */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* --- Focus indicators (:focus-visible) --- */
/*
 * Consistent 2px solid outline using the project purple (--pico-primary).
 * `:focus-visible` prevents focus rings on mouse clicks while keeping them
 * for keyboard navigation, as per WCAG 2.4.7 and 2.4.11.
 * All elements below suppress the browser default outline first, then
 * re-apply our custom one via :focus-visible.
 */

/* Global reset: suppress browser default outlines on interactive elements.
 * We then selectively restore visible focus rings below. */
a:focus,
button:focus,
[tabindex]:focus,
.filter-multiselect-trigger:focus,
.tag-multiselect-trigger:focus,
.settings-gear-btn:focus,
[data-editable]:focus {
  outline: none;
}

/* Nav tab links */
nav.nav-tabs ul:last-child li a:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: 2px;
}

/* Board cards (tabindex="0") */
.board-card:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: var(--pico-border-radius, 0.25rem);
}

[data-theme="dark"] .board-card:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Board card inner links — suppress double ring when card already has focus */
.board-card-header a:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: 2px;
}

[data-theme="dark"] .board-card-header a:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Task list links (ID column, epic-badge) */
td a:focus-visible,
.epic-badge:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: 2px;
}

[data-theme="dark"] td a:focus-visible,
[data-theme="dark"] .epic-badge:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Editable fields — keyboard focus ring when NOT in edit mode */
[data-editable]:not(.editing):focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: var(--pico-border-radius, 0.25rem);
}

[data-theme="dark"] [data-editable]:not(.editing):focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Multi-select triggers (status/priority/tag filters) */
.filter-multiselect-trigger:focus-visible,
.tag-multiselect-trigger:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  /* Keep the existing box-shadow focus style as a secondary indicator */
  box-shadow: 0 0 0 2px var(--pico-primary-focus, rgba(124, 58, 237, 0.375));
}

[data-theme="dark"] .filter-multiselect-trigger:focus-visible,
[data-theme="dark"] .tag-multiselect-trigger:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
  box-shadow: 0 0 0 2px var(--pico-primary-focus, rgba(167, 139, 250, 0.375));
}

/* Filter pill remove buttons */
.filter-tag-pill-remove:focus-visible,
.filter-multiselect-pill-remove:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 1px;
  border-radius: 50%;
}

[data-theme="dark"] .filter-tag-pill-remove:focus-visible,
[data-theme="dark"] .filter-multiselect-pill-remove:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Inline edit save/cancel buttons */
.inline-edit-btn:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 1px;
}

[data-theme="dark"] .inline-edit-btn:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Settings gear button */
.settings-gear-btn:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed) !important;
  outline-offset: 2px;
  border-radius: var(--pico-border-radius, 0.25rem);
}

[data-theme="dark"] .settings-gear-btn:focus-visible {
  outline-color: var(--pico-primary, #a78bfa) !important;
}

/* Settings menu buttons */
.settings-menu-btn:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: -2px;
}

[data-theme="dark"] .settings-menu-btn:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* View toggle buttons (epic detail list/board toggle) */
a.view-toggle-btn:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: -2px;
}

[data-theme="dark"] a.view-toggle-btn:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Modal interactive elements: links inside modal article */
#task-modal a:focus-visible,
#task-modal button:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: 2px;
  border-radius: 2px;
}

[data-theme="dark"] #task-modal a:focus-visible,
[data-theme="dark"] #task-modal button:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* Tag dropdown options (keyboard-navigable list items) */
.tag-dropdown-option:focus-visible,
.filter-multiselect-dropdown li:focus-visible {
  outline: 2px solid var(--pico-primary, #7c3aed);
  outline-offset: -2px;
}

[data-theme="dark"] .tag-dropdown-option:focus-visible,
[data-theme="dark"] .filter-multiselect-dropdown li:focus-visible {
  outline-color: var(--pico-primary, #a78bfa);
}

/* --- Responsive Design --- */

/*
 * Tablet breakpoint: 768px and below.
 *
 * - Board: switch from 4-column grid to 2×2 grid.
 * - Filter bar: allow grid cells to wrap (2 per row instead of 4+).
 * - Table: Tags and Updated columns hidden; table gets horizontal scroll
 *   wrapper (applied via overflow-x:auto on a parent in JS — or directly on
 *   the table element which Pico does not constrain).
 * - Nav: keep horizontal but compress spacing a little.
 * - Settings dropdown: stay right-aligned (already is via `right: 0`).
 */
@media (max-width: 768px) {
  /* Board: 2×2 grid instead of 4 equal columns */
  #board-columns.grid {
    grid-template-columns: repeat(2, 1fr);
  }

  /* Filter bar: 2 columns instead of 4+ */
  form .grid {
    grid-template-columns: repeat(2, 1fr);
  }

  /* Task table: allow horizontal scrolling so layout does not break */
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Hide lower-priority columns on tablets */
  table thead th:nth-child(5),  /* Tags */
  table thead th:nth-child(6),  /* Updated */
  table tbody td:nth-child(5),  /* Tags */
  table tbody td:nth-child(6) { /* Updated */
    display: none;
  }

  /* Modals: limit width and add sensible padding */
  dialog article {
    max-width: 90vw;
    margin: auto;
  }

  /* Reduce container padding slightly to reclaim horizontal space */
  .container {
    padding-left: var(--pico-spacing, 1rem);
    padding-right: var(--pico-spacing, 1rem);
  }
}

/*
 * Mobile breakpoint: 480px and below.
 *
 * - Board: single column, vertical scroll.
 * - Filter bar: stack all filters in a single column.
 * - Nav: compress to allow all items to fit; "Tacks" brand is kept.
 * - Table: only ID and Title visible; horizontal scroll for the rest.
 * - Modal: full-width.
 * - Toast: narrower, left-anchored so it does not clip on narrow screens.
 */
@media (max-width: 480px) {
  /* Board: single-column stack */
  #board-columns.grid {
    grid-template-columns: 1fr;
  }

  /* Filter bar: single column, each filter full-width */
  form .grid {
    grid-template-columns: 1fr;
  }

  /* Also hide Status and Priority columns on mobile — keep ID + Title only */
  table thead th:nth-child(3),  /* Status */
  table thead th:nth-child(4),  /* Priority */
  table tbody td:nth-child(3),  /* Status */
  table tbody td:nth-child(4) { /* Priority */
    display: none;
  }

  /* Modal: full viewport width, no horizontal margin */
  dialog article {
    max-width: 100vw;
    margin: 0;
    border-radius: 0;
  }

  /* Nav: reduce gap between items so everything fits in one row */
  nav.nav-tabs ul:last-child {
    gap: 0.25rem;
  }

  nav.nav-tabs ul:last-child li a {
    padding: 0.5rem 0;
    font-size: 0.875rem;
  }

  /* Toast container: anchor to bottom corners, narrower max-width */
  #toast-container {
    left: 0.75rem;
    right: 0.75rem;
    bottom: 0.75rem;
  }

  .toast {
    max-width: 100%;
  }

  /* Settings dropdown: keep right-aligned (right:0) so it doesn't clip.
   * No change needed since it's already `right: 0` — but cap min-width so
   * it doesn't push off-screen on very narrow viewports. */
  .settings-menu {
    min-width: 8rem;
  }
}
